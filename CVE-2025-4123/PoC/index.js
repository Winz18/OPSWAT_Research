import express from "express";
import fs from "node:fs";

const app = express();

const json = JSON.parse(fs.readFileSync(`./module.json`, 'utf8'));
const js = fs.readFileSync(`./module.js`, 'utf8');

app.use(/(.*)/, (req, res, next) => {
    res.setHeader("Access-Control-Allow-Origin", "*");
    res.setHeader("Access-Control-Allow-Methods", "GET, POST, PUT, DELETE, OPTIONS");
    res.setHeader("Access-Control-Allow-Headers", "Content-Type, Authorization, x-grafana-device-id, x-grafana-org-id");
    res.setHeader("Access-Control-Allow-Credentials", "true");
    next();
});

app.get("/module.js", (req, res) => {
    return res.status(200).type("application/javascript").send(js);
});

app.use(/(.*)/, (req, res) => {
    return res.status(200).json(json);
});

app.listen(1337, '0.0.0.0');